<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HttpSession Integration :: Spring</title>
    <link rel="prev" href="modules.html">
    <link rel="next" href="web-socket.html">
    <meta name="generator" content="Antora 3.0.0-alpha.8">
    <link rel="stylesheet" href="../_/css/site.css">

<link href="../_/img/favicon.ico" rel='shortcut icon' type='image/vnd.microsoft.icon'>
<link rel="stylesheet" href="../_/css/vendor/docsearch.min.css">
<!-- fetched from https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css -->
    <script>var uiRootPath = '../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://spring.io">
        <img id="springlogo" class="block" src="../_/img/spring-logo.svg" alt="Spring">
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Why Spring</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://spring.io/why-spring">Overview</a>
            <a class="navbar-item" href="https://spring.io/microservices">Microservices</a>
            <a class="navbar-item" href="https://spring.io/reactive">Reactive</a>
            <a class="navbar-item" href="https://spring.io/event-driven">Event Driven</a>
            <a class="navbar-item" href="https://spring.io/cloud">Cloud</a>
            <a class="navbar-item" href="https://spring.io/web-applications">Web Applications</a>
            <a class="navbar-item" href="https://spring.io/serverless">Serverless</a>
            <a class="navbar-item" href="https://spring.io/batch">Batch</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Learn</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://spring.io/learn">Overview</a>
            <a class="navbar-item" href="https://spring.io/quickstart">Quickstart</a>
            <a class="navbar-item" href="https://spring.io/guides">Guides</a>
            <a class="navbar-item" href="https://spring.io/blog">Blog</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Projects</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://spring.io/projects">Overview</a>
            <a class="navbar-item" href="https://spring.io/projects/spring-boot">Spring Boot</a>
            <a class="navbar-item" href="https://spring.io/projects/spring-framework">Spring Framework</a>
            <a class="navbar-item" href="https://spring.io/projects/spring-cloud">Spring Cloud</a>
            <a class="navbar-item" href="https://spring.io/projects/spring-cloud-dataflow">Spring Cloud Data Flow</a>
            <a class="navbar-item" href="https://spring.io/projects/spring-data">Spring Data</a>
            <a class="navbar-item" href="https://spring.io/projects/spring-integration">Spring Integration</a>
            <a class="navbar-item" href="https://spring.io/projects/spring-batch">Spring Batch</a>
            <a class="navbar-item" href="https://spring.io/projects/spring-security">Spring Security</a>
            <a class="navbar-item navbar-item-special" href="https://spring.io/projects">View all projects</a>
            <a class="navbar-item" href="https://spring.io/tools">Spring Tools 4</a>
            <a class="navbar-item navbar-item-special-2" href="https://start.spring.io">Spring Initializr <svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><polyline points="15 10.94 15 15 1 15 1 1 5.06 1" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="2"></polyline><polyline points="8.93 1 15 1 15 7.07" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="2"></polyline><line x1="15" y1="1" x2="8" y2="8" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="2"></line></svg></a>
          </div>
        </div>

        <a class="navbar-item" href="https://spring.io/training">Training</a>
        <a class="navbar-item" href="https://spring.io/support">Support</a>
        <div class="navbar-item has-dropdown is-hoverable is-community">
          <a class="navbar-link" href="#">Community</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://spring.io/community">Overview</a>
            <a class="navbar-item" href="https://spring.io/events">Events</a>
            <a class="navbar-item" href="https://spring.io/team">Team</a>
          </div>
        </div>
      </div>
    </div>
    <div id="switch-theme">
      <input type="checkbox" id="switch-theme-checkbox" />
      <label for="switch-theme-checkbox">Dark Theme</label>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="session" data-version="">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Spring Session</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="whats-new.html">What&#8217;s New</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="samples.html">Samples &amp; Guides (Start Here)</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Boot Samples</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">HttpSession</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Redis</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="https://github.com/spring-projects/spring-session/tree/main/spring-session-samples/spring-session-sample-boot-redis-json">JSON serialization</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="https://github.com/spring-projects/spring-session/tree/main/spring-session-samples/spring-session-sample-boot-redis-simple">Simple Redis</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="guides/boot-redis.html">Redis with Events</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="guides/boot-jdbc.html">JDBC</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="https://github.com/spring-projects/spring-session/tree/main/spring-session-samples/spring-session-sample-boot-hazelcast">HttpSession with Hazelcast</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="guides/boot-findbyusername.html">Find by Username</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="guides/boot-websocket.html">WebSockets</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">WebFlux</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="https://github.com/spring-projects/spring-session/tree/main/spring-session-samples/spring-session-sample-boot-webflux">Redis</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="guides/boot-webflux-custom-cookie.html">Custom Cookie</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text">Java Configuration</span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text">XML Configuration</span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="modules.html">Modules</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="http-session.html">HttpSession Integration</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="web-socket.html">WebSocket Integration</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="web-session.html">WebSession Integration</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="spring-security.html">Spring Security Integration</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="api.html">API Documentation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="upgrading.html">Upgrading</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Spring Session</span>
    <span class="version">2.6</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../index.html">Spring Security</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../index.html">5.6</a>
        </li>
        <li class="version">
          <a href="../5.5/index.html">5.5</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="index.html">Spring Session</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">2.6</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Spring Session</a></li>
    <li><a href="http-session.html">HttpSession Integration</a></li>
  </ul>
</nav>
<div class="search">
  <input id="search-input" type="text" placeholder="Search docs">
</div>
  <div class="edit-this-page"><a href="https://github.com/rwinch/spring-session/edit/antora/main/spring-session-docs/modules/ROOT/pages/http-session.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 id="page-title" class="page"><code>HttpSession</code> Integration</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Spring Session provides transparent integration with <code>HttpSession</code>.
This means that developers can switch the <code>HttpSession</code> implementation out with an implementation that is backed by Spring Session.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="httpsession-why"><a class="anchor" href="#httpsession-why"></a>Why Spring Session and <code>HttpSession</code>?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We have already mentioned that Spring Session provides transparent integration with <code>HttpSession</code>, but what benefits do we get out of this?</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Clustered Sessions</strong>: Spring Session makes it trivial to support <a href="#httpsession-redis">clustered sessions</a> without being tied to an application container specific solution.</p>
</li>
<li>
<p><strong>RESTful APIs</strong>: Spring Session lets providing session IDs in headers work with <a href="#httpsession-rest">RESTful APIs</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="httpsession-redis"><a class="anchor" href="#httpsession-redis"></a><code>HttpSession</code> with Redis</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using Spring Session with <code>HttpSession</code> is enabled by adding a Servlet Filter before anything that uses the <code>HttpSession</code>.
You can choose from enabling this by using either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#httpsession-redis-jc">Java-based Configuration</a></p>
</li>
<li>
<p><a href="#httpsession-redis-xml">XML-based Configuration</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="httpsession-redis-jc"><a class="anchor" href="#httpsession-redis-jc"></a>Redis Java-based Configuration</h3>
<div class="paragraph">
<p>This section describes how to use Redis to back <code>HttpSession</code> by using Java based configuration.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <a href="samples.html#samples" class="page"> HttpSession Sample</a> provides a working sample of how to integrate Spring Session and <code>HttpSession</code> by using Java configuration.
You can read the basic steps for integration in the next few sections, but we encourage you to follow along with the detailed HttpSession Guide when integrating with your own application.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="httpsession-spring-configuration"><a class="anchor" href="#httpsession-spring-configuration"></a>Spring Java Configuration</h4>
<div class="paragraph">
<p>After adding the required dependencies, we can create our Spring configuration.
The Spring configuration is responsible for creating a servlet filter that replaces the <code>HttpSession</code> implementation with an implementation backed by Spring Session.
To do so, add the following Spring Configuration:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@EnableRedisHttpSession <i class="conum" data-value="1"></i><b>(1)</b>
public class Config {

	@Bean
	public LettuceConnectionFactory connectionFactory() {
		return new LettuceConnectionFactory(); <i class="conum" data-value="2"></i><b>(2)</b>
	}

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@EnableRedisHttpSession</code> annotation creates a Spring Bean with the name of <code>springSessionRepositoryFilter</code> that implements <code>Filter</code>.
The filter is in charge of replacing the <code>HttpSession</code> implementation to be backed by Spring Session.
In this instance, Spring Session is backed by Redis.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We create a <code>RedisConnectionFactory</code> that connects Spring Session to the Redis Server.
We configure the connection to connect to localhost on the default port (6379).
For more information on configuring Spring Data Redis, see the <a href="https://docs.spring.io/spring-data/data-redis/docs/2.6.0-M2/reference/html/">reference documentation</a>.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_java_servlet_container_initialization"><a class="anchor" href="#_java_servlet_container_initialization"></a>Java Servlet Container Initialization</h4>
<div class="paragraph">
<p>Our <a href="#httpsession-spring-configuration">Spring Configuration</a> created a Spring Bean named <code>springSessionRepositoryFilter</code> that implements <code>Filter</code>.
The <code>springSessionRepositoryFilter</code> bean is responsible for replacing the <code>HttpSession</code> with a custom implementation that is backed by Spring Session.</p>
</div>
<div class="paragraph">
<p>In order for our <code>Filter</code> to do its magic, Spring needs to load our <code>Config</code> class.
Last, we need to ensure that our Servlet Container (that is, Tomcat) uses our <code>springSessionRepositoryFilter</code> for every request.
Fortunately, Spring Session provides a utility class named <code>AbstractHttpSessionApplicationInitializer</code> to make both of these steps easy.
The following shows an example:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">src/main/java/sample/Initializer.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Initializer extends AbstractHttpSessionApplicationInitializer { <i class="conum" data-value="1"></i><b>(1)</b>

	public Initializer() {
		super(Config.class); <i class="conum" data-value="2"></i><b>(2)</b>
	}

}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The name of our class (<code>Initializer</code>) does not matter. What is important is that we extend <code>AbstractHttpSessionApplicationInitializer</code>.
</td>
</tr>
</table>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The first step is to extend <code>AbstractHttpSessionApplicationInitializer</code>.
Doing so ensures that the Spring Bean by the name of <code>springSessionRepositoryFilter</code> is registered with our Servlet Container for every request.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>AbstractHttpSessionApplicationInitializer</code> also provides a mechanism to ensure Spring loads our <code>Config</code>.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="httpsession-redis-xml"><a class="anchor" href="#httpsession-redis-xml"></a>Redis XML-based Configuration</h3>
<div class="paragraph">
<p>This section describes how to use Redis to back <code>HttpSession</code> by using XML based configuration.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <a href="samples.html#samples" class="page"> HttpSession XML Sample</a> provides a working sample of how to integrate Spring Session and <code>HttpSession</code> using XML configuration.
You can read the basic steps for integration in the next few sections, but we encourage you to follow along with the detailed HttpSession XML Guide when integrating with your own application.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="httpsession-xml-spring-configuration"><a class="anchor" href="#httpsession-xml-spring-configuration"></a>Spring XML Configuration</h4>
<div class="paragraph">
<p>After adding the required dependencies, we can create our Spring configuration.
The Spring configuration is responsible for creating a servlet filter that replaces the <code>HttpSession</code> implementation with an implementation backed by Spring Session.
To do so, add the following Spring Configuration:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">src/main/webapp/WEB-INF/spring/session.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><i class="conum" data-value="1"></i><b>(1)</b>
&lt;context:annotation-config/&gt;
&lt;bean class="org.springframework.session.data.redis.config.annotation.web.http.RedisHttpSessionConfiguration"/&gt;

<i class="conum" data-value="2"></i><b>(2)</b>
&lt;bean class="org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory"/&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We use the combination of <code>&lt;context:annotation-config/&gt;</code> and <code>RedisHttpSessionConfiguration</code> because Spring Session does not yet provide XML Namespace support (see <a href="https://github.com/spring-projects/spring-session/issues/104">gh-104</a>).
This creates a Spring Bean with the name of <code>springSessionRepositoryFilter</code> that implements <code>Filter</code>.
The filter is in charge of replacing the <code>HttpSession</code> implementation to be backed by Spring Session.
In this instance, Spring Session is backed by Redis.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We create a <code>RedisConnectionFactory</code> that connects Spring Session to the Redis Server.
We configure the connection to connect to localhost on the default port (6379)
For more information on configuring Spring Data Redis, see the <a href="https://docs.spring.io/spring-data/data-redis/docs/2.6.0-M2/reference/html/">reference documentation</a>.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_xml_servlet_container_initialization"><a class="anchor" href="#_xml_servlet_container_initialization"></a>XML Servlet Container Initialization</h4>
<div class="paragraph">
<p>Our <a href="#httpsession-xml-spring-configuration">Spring Configuration</a> created a Spring Bean named <code>springSessionRepositoryFilter</code> that implements <code>Filter</code>.
The <code>springSessionRepositoryFilter</code> bean is responsible for replacing the <code>HttpSession</code> with a custom implementation that is backed by Spring Session.</p>
</div>
<div class="paragraph">
<p>In order for our <code>Filter</code> to do its magic, we need to instruct Spring to load our <code>session.xml</code> configuration.
We can do so with the following configuration:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">src/main/webapp/WEB-INF/web.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;context-param&gt;
	&lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
	&lt;param-value&gt;
		/WEB-INF/spring/session.xml
	&lt;/param-value&gt;
&lt;/context-param&gt;
&lt;listener&gt;
	&lt;listener-class&gt;
		org.springframework.web.context.ContextLoaderListener
	&lt;/listener-class&gt;
&lt;/listener&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <a href="https://docs.spring.io/spring/docs/5.3.9/spring-framework-reference/core.html#context-create"><code>ContextLoaderListener</code></a> reads the contextConfigLocation and picks up our session.xml configuration.</p>
</div>
<div class="paragraph">
<p>Last, we need to ensure that our Servlet Container (that is, Tomcat) uses our <code>springSessionRepositoryFilter</code> for every request.
The following snippet performs this last step for us:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">src/main/webapp/WEB-INF/web.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;filter&gt;
	&lt;filter-name&gt;springSessionRepositoryFilter&lt;/filter-name&gt;
	&lt;filter-class&gt;org.springframework.web.filter.DelegatingFilterProxy&lt;/filter-class&gt;
&lt;/filter&gt;
&lt;filter-mapping&gt;
	&lt;filter-name&gt;springSessionRepositoryFilter&lt;/filter-name&gt;
	&lt;url-pattern&gt;/*&lt;/url-pattern&gt;
	&lt;dispatcher&gt;REQUEST&lt;/dispatcher&gt;
	&lt;dispatcher&gt;ERROR&lt;/dispatcher&gt;
&lt;/filter-mapping&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <a href="https://docs.spring.io/spring-framework/docs/5.3.9/javadoc-api/org/springframework/web/filter/DelegatingFilterProxy.html"><code>DelegatingFilterProxy</code></a> looks up a Bean by the name of <code>springSessionRepositoryFilter</code> and cast it to a <code>Filter</code>.
For every request that <code>DelegatingFilterProxy</code> is invoked, the <code>springSessionRepositoryFilter</code> is invoked.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="httpsession-jdbc"><a class="anchor" href="#httpsession-jdbc"></a><code>HttpSession</code> with JDBC</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can use Spring Session with <code>HttpSession</code> by adding a servlet filter before anything that uses the <code>HttpSession</code>.
You can choose to do in any of the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#httpsession-jdbc-jc">Java-based Configuration</a></p>
</li>
<li>
<p><a href="#httpsession-jdbc-xml">XML-based Configuration</a></p>
</li>
<li>
<p><a href="#httpsession-jdbc-boot">Spring Boot-based Configuration</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="httpsession-jdbc-jc"><a class="anchor" href="#httpsession-jdbc-jc"></a>JDBC Java-based Configuration</h3>
<div class="paragraph">
<p>This section describes how to use a relational database to back <code>HttpSession</code> when you use Java-based configuration.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <a href="samples.html#samples" class="page"> HttpSession JDBC Sample</a> provides a working sample of how to integrate Spring Session and <code>HttpSession</code> by using Java configuration.
You can read the basic steps for integration in the next few sections, but we encouraged you to follow along with the detailed HttpSession JDBC Guide when integrating with your own application.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="httpsession-jdbc-spring-configuration"><a class="anchor" href="#httpsession-jdbc-spring-configuration"></a>Spring Java Configuration</h4>
<div class="paragraph">
<p>After adding the required dependencies, we can create our Spring configuration.
The Spring configuration is responsible for creating a Servlet Filter that replaces the <code>HttpSession</code> implementation with an implementation backed by Spring Session.
To do so, add the following Spring Configuration:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@EnableJdbcHttpSession <i class="conum" data-value="1"></i><b>(1)</b>
public class Config {

	@Bean
	public EmbeddedDatabase dataSource() {
		return new EmbeddedDatabaseBuilder() <i class="conum" data-value="2"></i><b>(2)</b>
				.setType(EmbeddedDatabaseType.H2).addScript("org/springframework/session/jdbc/schema-h2.sql").build();
	}

	@Bean
	public PlatformTransactionManager transactionManager(DataSource dataSource) {
		return new DataSourceTransactionManager(dataSource); <i class="conum" data-value="3"></i><b>(3)</b>
	}

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@EnableJdbcHttpSession</code> annotation creates a Spring Bean with the name of <code>springSessionRepositoryFilter</code>.
That bean implements <code>Filter</code>.
The filter is in charge of replacing the <code>HttpSession</code> implementation to be backed by Spring Session.
In this instance, Spring Session is backed by a relational database.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We create a <code>dataSource</code> that connects Spring Session to an embedded instance of an H2 database.
We configure the H2 database to create database tables by using the SQL script that is included in Spring Session.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>We create a <code>transactionManager</code> that manages transactions for previously configured <code>dataSource</code>.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>For additional information on how to configure data access related concerns, see the <a href="https://docs.spring.io/spring/docs/5.3.9/spring-framework-reference/data-access.html">Spring Framework Reference Documentation</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_java_servlet_container_initialization_2"><a class="anchor" href="#_java_servlet_container_initialization_2"></a>Java Servlet Container Initialization</h4>
<div class="paragraph">
<p>Our <a href="#httpsession-jdbc-spring-configuration">Spring Configuration</a> created a Spring bean named <code>springSessionRepositoryFilter</code> that implements <code>Filter</code>.
The <code>springSessionRepositoryFilter</code> bean is responsible for replacing the <code>HttpSession</code> with a custom implementation that is backed by Spring Session.</p>
</div>
<div class="paragraph">
<p>In order for our <code>Filter</code> to do its magic, Spring needs to load our <code>Config</code> class.
Last, we need to ensure that our Servlet Container (that is, Tomcat) uses our <code>springSessionRepositoryFilter</code> for every request.
Fortunately, Spring Session provides a utility class named <code>AbstractHttpSessionApplicationInitializer</code> to make both of these steps easy.
The following example shows how to do so:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">src/main/java/sample/Initializer.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Initializer extends AbstractHttpSessionApplicationInitializer { <i class="conum" data-value="1"></i><b>(1)</b>

	public Initializer() {
		super(Config.class); <i class="conum" data-value="2"></i><b>(2)</b>
	}

}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The name of our class (Initializer) does not matter.
What is important is that we extend <code>AbstractHttpSessionApplicationInitializer</code>.
</td>
</tr>
</table>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The first step is to extend <code>AbstractHttpSessionApplicationInitializer</code>.
Doing so ensures that the Spring bean named <code>springSessionRepositoryFilter</code> is registered with our Servlet Container for every request.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>AbstractHttpSessionApplicationInitializer</code> also provides a mechanism to ensure Spring loads our <code>Config</code>.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_multiple_datasources"><a class="anchor" href="#_multiple_datasources"></a>Multiple DataSources</h4>
<div class="paragraph">
<p>Spring Session provides the <code>@SpringSessionDataSource</code> qualifier, allowing you to explicitly declare which <code>DataSource</code> bean should be injected in <code>JdbcIndexedSessionRepository</code>.
This is particularly useful in scenarios with multiple <code>DataSource</code> beans present in the application context.</p>
</div>
<div class="paragraph">
<p>The following example shows how to do so:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">Config.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@EnableJdbcHttpSession
public class Config {

	@Bean
	@SpringSessionDataSource <i class="conum" data-value="1"></i><b>(1)</b>
	public EmbeddedDatabase firstDataSource() {
		return new EmbeddedDatabaseBuilder()
				.setType(EmbeddedDatabaseType.H2).addScript("org/springframework/session/jdbc/schema-h2.sql").build();
	}

	@Bean
	public HikariDataSource secondDataSource() {
		// ...
	}
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This qualifier declares that firstDataSource is to be used by Spring Session.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="httpsession-jdbc-xml"><a class="anchor" href="#httpsession-jdbc-xml"></a>JDBC XML-based Configuration</h3>
<div class="paragraph">
<p>This section describes how to use a relational database to back <code>HttpSession</code> when you use XML based configuration.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <a href="samples.html#samples" class="page"> HttpSession JDBC XML Sample</a> provides a working sample of how to integrate Spring Session and <code>HttpSession</code> by using XML configuration.
You can read the basic steps for integration in the next few sections, but we encourage you to follow along with the detailed HttpSession JDBC XML Guide when integrating with your own application.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="httpsession-jdbc-xml-spring-configuration"><a class="anchor" href="#httpsession-jdbc-xml-spring-configuration"></a>Spring XML Configuration</h4>
<div class="paragraph">
<p>After adding the required dependencies, we can create our Spring configuration.
The Spring configuration is responsible for creating a servlet filter that replaces the <code>HttpSession</code> implementation with an implementation backed by Spring Session.
The following listing shows how to add the following Spring Configuration:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">src/main/webapp/WEB-INF/spring/session.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><i class="conum" data-value="1"></i><b>(1)</b>
&lt;context:annotation-config/&gt;
&lt;bean class="org.springframework.session.jdbc.config.annotation.web.http.JdbcHttpSessionConfiguration"/&gt;

<i class="conum" data-value="2"></i><b>(2)</b>
&lt;jdbc:embedded-database id="dataSource" database-name="testdb" type="H2"&gt;
	&lt;jdbc:script location="classpath:org/springframework/session/jdbc/schema-h2.sql"/&gt;
&lt;/jdbc:embedded-database&gt;

<i class="conum" data-value="3"></i><b>(3)</b>
&lt;bean class="org.springframework.jdbc.datasource.DataSourceTransactionManager"&gt;
	&lt;constructor-arg ref="dataSource"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We use the combination of <code>&lt;context:annotation-config/&gt;</code> and <code>JdbcHttpSessionConfiguration</code> because Spring Session does not yet provide XML Namespace support (see <a href="https://github.com/spring-projects/spring-session/issues/104">gh-104</a>).
This creates a Spring bean with the name of <code>springSessionRepositoryFilter</code>.
That bean implements <code>Filter</code>.
The filter is in charge of replacing the <code>HttpSession</code> implementation to be backed by Spring Session.
In this instance, Spring Session is backed by a relational database.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We create a <code>dataSource</code> that connects Spring Session to an embedded instance of an H2 database.
We configure the H2 database to create database tables by using the SQL script that is included in Spring Session.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>We create a <code>transactionManager</code> that manages transactions for previously configured <code>dataSource</code>.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>For additional information on how to configure data access-related concerns, see the <a href="https://docs.spring.io/spring/docs/5.3.9/spring-framework-reference/data-access.html">Spring Framework Reference Documentation</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_xml_servlet_container_initialization_2"><a class="anchor" href="#_xml_servlet_container_initialization_2"></a>XML Servlet Container Initialization</h4>
<div class="paragraph">
<p>Our <a href="#httpsession-jdbc-xml-spring-configuration">Spring Configuration</a> created a Spring bean named <code>springSessionRepositoryFilter</code> that implements <code>Filter</code>.
The <code>springSessionRepositoryFilter</code> bean is responsible for replacing the <code>HttpSession</code> with a custom implementation that is backed by Spring Session.</p>
</div>
<div class="paragraph">
<p>In order for our <code>Filter</code> to do its magic, we need to instruct Spring to load our <code>session.xml</code> configuration.
We do so with the following configuration:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">src/main/webapp/WEB-INF/web.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;context-param&gt;
	&lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
	&lt;param-value&gt;
		/WEB-INF/spring/session.xml
	&lt;/param-value&gt;
&lt;/context-param&gt;
&lt;listener&gt;
	&lt;listener-class&gt;
		org.springframework.web.context.ContextLoaderListener
	&lt;/listener-class&gt;
&lt;/listener&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <a href="https://docs.spring.io/spring/docs/5.3.9/spring-framework-reference/core.html#context-create"><code>ContextLoaderListener</code></a> reads the <code>contextConfigLocation</code> and picks up our session.xml configuration.</p>
</div>
<div class="paragraph">
<p>Last, we need to ensure that our Servlet Container (that is, Tomcat) uses our <code>springSessionRepositoryFilter</code> for every request.
The following snippet performs this last step for us:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">src/main/webapp/WEB-INF/web.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;filter&gt;
	&lt;filter-name&gt;springSessionRepositoryFilter&lt;/filter-name&gt;
	&lt;filter-class&gt;org.springframework.web.filter.DelegatingFilterProxy&lt;/filter-class&gt;
&lt;/filter&gt;
&lt;filter-mapping&gt;
	&lt;filter-name&gt;springSessionRepositoryFilter&lt;/filter-name&gt;
	&lt;url-pattern&gt;/*&lt;/url-pattern&gt;
	&lt;dispatcher&gt;REQUEST&lt;/dispatcher&gt;
	&lt;dispatcher&gt;ERROR&lt;/dispatcher&gt;
&lt;/filter-mapping&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <a href="https://docs.spring.io/spring-framework/docs/5.3.9/javadoc-api/org/springframework/web/filter/DelegatingFilterProxy.html"><code>DelegatingFilterProxy</code></a> looks up a bean named <code>springSessionRepositoryFilter</code> and casts it to a <code>Filter</code>.
For every request on which <code>DelegatingFilterProxy</code> is invoked, the <code>springSessionRepositoryFilter</code> is invoked.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="httpsession-jdbc-boot"><a class="anchor" href="#httpsession-jdbc-boot"></a>JDBC Spring Boot-based Configuration</h3>
<div class="paragraph">
<p>This section describes how to use a relational database to back <code>HttpSession</code> when you use Spring Boot.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <a href="samples.html#samples" class="page"> HttpSession JDBC Spring Boot Sample</a> provides a working sample of how to integrate Spring Session and <code>HttpSession</code> by using Spring Boot.
You can read the basic steps for integration in the next few sections, but we encourage you to follow along with the detailed HttpSession JDBC Spring Boot Guide when integrating with your own application.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="httpsession-jdbc-boot-spring-configuration"><a class="anchor" href="#httpsession-jdbc-boot-spring-configuration"></a>Spring Boot Configuration</h4>
<div class="paragraph">
<p>After adding the required dependencies, we can create our Spring Boot configuration.
Thanks to first-class auto configuration support, setting up Spring Session backed by a relational database is as simple as adding a single configuration property to your <code>application.properties</code>.
The following listing shows how to do so:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">src/main/resources/application.properties</div>
<div class="content">
<pre>spring.session.store-type=jdbc # Session store type.</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If a single Spring Session module is present on the classpath, Spring Boot uses that store implementation automatically.
If you have more than one implementation, you must choose the StoreType that you wish to use to store the sessions, as shows above.</p>
</div>
<div class="paragraph">
<p>Under the hood, Spring Boot applies configuration that is equivalent to manually adding the <code>@EnableJdbcHttpSession</code> annotation.
This creates a Spring bean with the name of <code>springSessionRepositoryFilter</code>. That bean implements <code>Filter</code>.
The filter is in charge of replacing the <code>HttpSession</code> implementation to be backed by Spring Session.</p>
</div>
<div class="paragraph">
<p>You can further customize by using <code>application.properties</code>.
The following listing shows how to do so:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">src/main/resources/application.properties</div>
<div class="content">
<pre>server.servlet.session.timeout= # Session timeout. If a duration suffix is not specified, seconds are used.
spring.session.jdbc.initialize-schema=embedded # Database schema initialization mode.
spring.session.jdbc.schema=classpath:org/springframework/session/jdbc/schema-@@platform@@.sql # Path to the SQL file to use to initialize the database schema.
spring.session.jdbc.table-name=SPRING_SESSION # Name of the database table used to store sessions.</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For more information, see the <a href="https://docs.spring.io/spring-boot/docs/2.5.3/reference/htmlsingle/#boot-features-session">Spring Session</a> portion of the Spring Boot documentation.</p>
</div>
</div>
<div class="sect3">
<h4 id="httpsession-jdbc-boot-configuration"><a class="anchor" href="#httpsession-jdbc-boot-configuration"></a>Configuring the <code>DataSource</code></h4>
<div class="paragraph">
<p>Spring Boot automatically creates a <code>DataSource</code> that connects Spring Session to an embedded instance of an H2 database.
In a production environment, you need to update your configuration to point to your relational database.
For example, you can include the following in your application.properties:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">src/main/resources/application.properties</div>
<div class="content">
<pre>spring.datasource.url= # JDBC URL of the database.
spring.datasource.username= # Login username of the database.
spring.datasource.password= # Login password of the database.</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For more information, see the <a href="https://docs.spring.io/spring-boot/docs/2.5.3/reference/htmlsingle/#boot-features-configure-datasource">Configure a DataSource</a> portion of the Spring Boot documentation.</p>
</div>
</div>
<div class="sect3">
<h4 id="httpsession-jdbc-boot-servlet-configuration"><a class="anchor" href="#httpsession-jdbc-boot-servlet-configuration"></a>Servlet Container Initialization</h4>
<div class="paragraph">
<p>Our <a href="#httpsession-jdbc-boot-spring-configuration">Spring Boot Configuration</a> created a Spring bean named <code>springSessionRepositoryFilter</code> that implements <code>Filter</code>.
The <code>springSessionRepositoryFilter</code> bean is responsible for replacing the <code>HttpSession</code> with a custom implementation that is backed by Spring Session.</p>
</div>
<div class="paragraph">
<p>In order for our <code>Filter</code> to do its magic, Spring needs to load our <code>Config</code> class.
Last, we need to ensure that our Servlet Container (that is, Tomcat) uses our <code>springSessionRepositoryFilter</code> for every request.
Fortunately, Spring Boot takes care of both of these steps for us.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="httpsession-hazelcast"><a class="anchor" href="#httpsession-hazelcast"></a>HttpSession with Hazelcast</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using Spring Session with <code>HttpSession</code> is enabled by adding a Servlet Filter before anything that uses the <code>HttpSession</code>.</p>
</div>
<div class="paragraph">
<p>This section describes how to use Hazelcast to back <code>HttpSession</code> by using Java-based configuration.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <a href="samples.html#samples" class="page"> Hazelcast Spring Sample</a> provides a working sample of how to integrate Spring Session and <code>HttpSession</code> by using Java configuration.
You can read the basic steps for integration in the next few sections, but we encourage you to follow along with the detailed Hazelcast Spring Guide when integrating with your own application.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="security-spring-configuration"><a class="anchor" href="#security-spring-configuration"></a>Spring Configuration</h3>
<div class="paragraph">
<p>After adding the required dependencies, we can create our Spring configuration.
The Spring configuration is responsible for creating a servlet filter that replaces the <code>HttpSession</code> implementation with an implementation backed by Spring Session.
To do so, add the following Spring Configuration:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@EnableHazelcastHttpSession <i class="conum" data-value="1"></i><b>(1)</b>
@Configuration
public class HazelcastHttpSessionConfig {

	@Bean
	public HazelcastInstance hazelcastInstance() {
		Config config = new Config();
		MapAttributeConfig attributeConfig = new MapAttributeConfig()
				.setName(HazelcastIndexedSessionRepository.PRINCIPAL_NAME_ATTRIBUTE)
				.setExtractor(PrincipalNameExtractor.class.getName());
		config.getMapConfig(HazelcastIndexedSessionRepository.DEFAULT_SESSION_MAP_NAME) <i class="conum" data-value="2"></i><b>(2)</b>
				.addMapAttributeConfig(attributeConfig).addMapIndexConfig(
						new MapIndexConfig(HazelcastIndexedSessionRepository.PRINCIPAL_NAME_ATTRIBUTE, false));
		SerializerConfig serializerConfig = new SerializerConfig();
		serializerConfig.setImplementation(new HazelcastSessionSerializer()).setTypeClass(MapSession.class);
		config.getSerializationConfig().addSerializerConfig(serializerConfig); <i class="conum" data-value="3"></i><b>(3)</b>
		return Hazelcast.newHazelcastInstance(config); <i class="conum" data-value="4"></i><b>(4)</b>
	}

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@EnableHazelcastHttpSession</code> annotation creates a Spring bean named <code>springSessionRepositoryFilter</code> that implements <code>Filter</code>.
The filter is in charge of replacing the <code>HttpSession</code> implementation to be backed by Spring Session.
In this instance, Spring Session is backed by Hazelcast.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>In order to support retrieval of sessions by principal name index, an appropriate <code>ValueExtractor</code> needs to be registered.
Spring Session provides <code>PrincipalNameExtractor</code> for this purpose.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>In order to serialize <code>MapSession</code> objects efficiently, <code>HazelcastSessionSerializer</code> needs to be registered. If this
is not set, Hazelcast will serialize sessions using native Java serialization.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>We create a <code>HazelcastInstance</code> that connects Spring Session to Hazelcast.
By default, the application starts and connects to an embedded instance of Hazelcast.
For more information on configuring Hazelcast, see the <a href="https://docs.hazelcast.org/docs/3.12.12/manual/html-single/index.html#hazelcast-configuration">reference documentation</a>.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If <code>HazelcastSessionSerializer</code> is preferred, it needs to be configured for all Hazelcast cluster members before they start.
In a Hazelcast cluster, all members should use the same serialization method for sessions. Also, if Hazelcast Client/Server topology
is used, then both members and clients must use the same serialization method. The serializer can be registered via <code>ClientConfig</code>
with the same <code>SerializerConfiguration</code> of members.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_servlet_container_initialization"><a class="anchor" href="#_servlet_container_initialization"></a>Servlet Container Initialization</h3>
<div class="paragraph">
<p>Our <a href="guides/java-security.html#security-spring-configuration" class="page">Spring Configuration</a> created a Spring bean named <code>springSessionRepositoryFilter</code> that implements <code>Filter</code>.
The <code>springSessionRepositoryFilter</code> bean is responsible for replacing the <code>HttpSession</code> with a custom implementation that is backed by Spring Session.</p>
</div>
<div class="paragraph">
<p>In order for our <code>Filter</code> to do its magic, Spring needs to load our <code>SessionConfig</code> class.
Since our application is already loading Spring configuration by using our <code>SecurityInitializer</code> class, we can add our <code>SessionConfig</code> class to it.
The following listing shows how to do so:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">src/main/java/sample/SecurityInitializer.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class SecurityInitializer extends AbstractSecurityWebApplicationInitializer {

	public SecurityInitializer() {
		super(SecurityConfig.class, SessionConfig.class);
	}

}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Last, we need to ensure that our Servlet Container (that is, Tomcat) uses our <code>springSessionRepositoryFilter</code> for every request.
It is extremely important that Spring Session&#8217;s <code>springSessionRepositoryFilter</code> is invoked before Spring Security&#8217;s <code>springSecurityFilterChain</code>.
Doing so ensures that the <code>HttpSession</code> that Spring Security uses is backed by Spring Session.
Fortunately, Spring Session provides a utility class named <code>AbstractHttpSessionApplicationInitializer</code> that makes this doing so easy.
The following example shows how to do so:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">src/main/java/sample/Initializer.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Initializer extends AbstractHttpSessionApplicationInitializer {

}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The name of our class (<code>Initializer</code>) does not matter. What is important is that we extend <code>AbstractHttpSessionApplicationInitializer</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By extending <code>AbstractHttpSessionApplicationInitializer</code>, we ensure that the Spring Bean named <code>springSessionRepositoryFilter</code> is registered with our servlet container for every request before Spring Security&#8217;s <code>springSecurityFilterChain</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="httpsession-how"><a class="anchor" href="#httpsession-how"></a>How <code>HttpSession</code> Integration Works</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Fortunately, both <code>HttpSession</code> and <code>HttpServletRequest</code> (the API for obtaining an <code>HttpSession</code>) are both interfaces.
This means that we can provide our own implementations for each of these APIs.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This section describes how Spring Session provides transparent integration with <code>HttpSession</code>. We offer this content so that you can understand what is happening under the covers. This functionality is already integrated and you do NOT need to implement this logic yourself.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>First, we create a custom <code>HttpServletRequest</code> that returns a custom implementation of <code>HttpSession</code>.
It looks something like the following:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class SessionRepositoryRequestWrapper extends HttpServletRequestWrapper {

	public SessionRepositoryRequestWrapper(HttpServletRequest original) {
		super(original);
	}

	public HttpSession getSession() {
		return getSession(true);
	}

	public HttpSession getSession(boolean createNew) {
		// create an HttpSession implementation from Spring Session
	}

	// ... other methods delegate to the original HttpServletRequest ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Any method that returns an <code>HttpSession</code> is overridden.
All other methods are implemented by <code>HttpServletRequestWrapper</code> and delegate to the original <code>HttpServletRequest</code> implementation.</p>
</div>
<div class="paragraph">
<p>We replace the <code>HttpServletRequest</code> implementation by using a servlet <code>Filter</code> called <code>SessionRepositoryFilter</code>.
The following pseudocode shows how it works:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class SessionRepositoryFilter implements Filter {

	public doFilter(ServletRequest request, ServletResponse response, FilterChain chain) {
		HttpServletRequest httpRequest = (HttpServletRequest) request;
		SessionRepositoryRequestWrapper customRequest =
			new SessionRepositoryRequestWrapper(httpRequest);

		chain.doFilter(customRequest, response, chain);
	}

	// ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>By passing a custom <code>HttpServletRequest</code> implementation into the <code>FilterChain</code>, we ensure that anything invoked after our <code>Filter</code> uses the custom <code>HttpSession</code> implementation.
This highlights why it is important that Spring Session&#8217;s <code>SessionRepositoryFilter</code> be placed before anything that interacts with the <code>HttpSession</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="httpsession-rest"><a class="anchor" href="#httpsession-rest"></a><code>HttpSession</code> and RESTful APIs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Session can work with RESTful APIs by letting the session be provided in a header.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <a href="samples.html#samples" class="page"> REST Sample</a> provides a working sample of how to use Spring Session in a REST application to support authenticating with a header.
You can follow the basic steps for integration described in the next few sections, but we encourage you to follow along with the detailed REST Guide when integrating with your own application.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="rest-spring-configuration"><a class="anchor" href="#rest-spring-configuration"></a>Spring Configuration</h3>
<div class="paragraph">
<p>After adding the required dependencies, we can create our Spring configuration.
The Spring configuration is responsible for creating a servlet filter that replaces the <code>HttpSession</code> implementation with an implementation backed by Spring Session.
To do so, add the following Spring Configuration:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Configuration
@EnableRedisHttpSession <i class="conum" data-value="1"></i><b>(1)</b>
public class HttpSessionConfig {

	@Bean
	public LettuceConnectionFactory connectionFactory() {
		return new LettuceConnectionFactory(); <i class="conum" data-value="2"></i><b>(2)</b>
	}

	@Bean
	public HttpSessionIdResolver httpSessionIdResolver() {
		return HeaderHttpSessionIdResolver.xAuthToken(); <i class="conum" data-value="3"></i><b>(3)</b>
	}

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@EnableRedisHttpSession</code> annotation creates a Spring bean named <code>springSessionRepositoryFilter</code> that implements <code>Filter</code>.
The filter is in charge of replacing the <code>HttpSession</code> implementation to be backed by Spring Session.
In this instance, Spring Session is backed by Redis.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We create a <code>RedisConnectionFactory</code> that connects Spring Session to the Redis Server.
We configure the connection to connect to localhost on the default port (6379).
For more information on configuring Spring Data Redis, see the <a href="https://docs.spring.io/spring-data/data-redis/docs/2.6.0-M2/reference/html/">reference documentation</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>We customize Spring Session&#8217;s HttpSession integration to use HTTP headers to convey the current session information instead of cookies.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_servlet_container_initialization_2"><a class="anchor" href="#_servlet_container_initialization_2"></a>Servlet Container Initialization</h3>
<div class="paragraph">
<p>Our <a href="#rest-spring-configuration">Spring Configuration</a> created a Spring Bean named <code>springSessionRepositoryFilter</code> that implements <code>Filter</code>.
The <code>springSessionRepositoryFilter</code> bean is responsible for replacing the <code>HttpSession</code> with a custom implementation that is backed by Spring Session.</p>
</div>
<div class="paragraph">
<p>In order for our <code>Filter</code> to do its magic, Spring needs to load our <code>Config</code> class.
We provide the configuration in our Spring <code>MvcInitializer</code>, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">src/main/java/sample/mvc/MvcInitializer.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Override
protected Class&lt;?&gt;[] getRootConfigClasses() {
	return new Class[] { SecurityConfig.class, HttpSessionConfig.class };
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Last, we need to ensure that our Servlet Container (that is, Tomcat) uses our <code>springSessionRepositoryFilter</code> for every request.
Fortunately, Spring Session provides a utility class named <code>AbstractHttpSessionApplicationInitializer</code> that makes doing so easy. To do so, extend the class with the default constructor, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">src/main/java/sample/Initializer.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Initializer extends AbstractHttpSessionApplicationInitializer {

}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The name of our class (<code>Initializer</code>) does not matter. What is important is that we extend <code>AbstractHttpSessionApplicationInitializer</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="httpsession-httpsessionlistener"><a class="anchor" href="#httpsession-httpsessionlistener"></a>Using <code>HttpSessionListener</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Session supports <code>HttpSessionListener</code> by translating <code>SessionDestroyedEvent</code> and <code>SessionCreatedEvent</code> into <code>HttpSessionEvent</code> by declaring <code>SessionEventHttpSessionListenerAdapter</code>.
To use this support, you need to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ensure your <code>SessionRepository</code> implementation supports and is configured to fire <code>SessionDestroyedEvent</code> and <code>SessionCreatedEvent</code>.</p>
</li>
<li>
<p>Configure <code>SessionEventHttpSessionListenerAdapter</code> as a Spring bean.</p>
</li>
<li>
<p>Inject every <code>HttpSessionListener</code> into the <code>SessionEventHttpSessionListenerAdapter</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you use the configuration support documented in <a href="#httpsession-redis"><code>HttpSession</code> with Redis</a>, all you need to do is register every <code>HttpSessionListener</code> as a bean.
For example, assume you want to support Spring Security&#8217;s concurrency control and need to use <code>HttpSessionEventPublisher</code>. In that case, you can add <code>HttpSessionEventPublisher</code> as a bean.
In Java configuration, this might look like the following:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Configuration
@EnableRedisHttpSession
public class RedisHttpSessionConfig {

	@Bean
	public HttpSessionEventPublisher httpSessionEventPublisher() {
		return new HttpSessionEventPublisher();
	}

	// ...

}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In XML configuration, this might look like the following:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;bean class="org.springframework.security.web.session.HttpSessionEventPublisher"/&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="modules.html">Modules</a></span>
  <span class="next"><a href="web-socket.html">WebSocket Integration</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer flex">
    <div id="spring-links flex">
        <img id="springlogo" src="../_/img/spring-logo.svg" alt="Spring">
        <p class="smallest antialiased">© <script>var d = new Date();
        document.write(d.getFullYear());</script> <a href="https://www.vmware.com/">VMware</a>, Inc. or its affiliates. <a href="https://www.vmware.com/help/legal.html">Terms of Use</a> • <a href="https://www.vmware.com/help/privacy.html" rel="noopener noreferrer">Privacy</a> • <a href="https://spring.io/trademarks">Trademark Guidelines</a> <span id="thank-you-mobile">• <a href="https://spring.io/thank-you">Thank you</a></span> • <a href="https://www.vmware.com/help/privacy/california-privacy-rights.html">Your California Privacy Rights</a> • <a class="ot-sdk-show-settings">Cookie Settings</a> <span id="teconsent"></span></p>
        <p class="smallest antialiased">Apache®, Apache Tomcat®, Apache Kafka®, Apache Cassandra&trade;, and Apache Geode&trade; are trademarks or registered trademarks of the Apache Software Foundation in the United States and/or other countries. Java&trade;, Java&trade; SE, Java&trade; EE, and OpenJDK&trade; are trademarks of Oracle and/or its affiliates. Kubernetes® is a registered trademark of the Linux Foundation in the United States and other countries. Linux® is the registered trademark of Linus Torvalds in the United States and other countries. Windows® and Microsoft® Azure are registered trademarks of Microsoft Corporation. “AWS” and “Amazon Web Services” are trademarks or registered trademarks of Amazon.com Inc. or its affiliates. All other trademarks and copyrights are property of their respective owners and are only mentioned for informative purposes. Other names may be trademarks of their respective owners.</p>
    </div>
    <div id="social-icons" class="flex jc-between">
        <a href="https://www.youtube.com/user/SpringSourceDev" title="Youtube"><svg id="youtube-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 40 40"><circle class="cls-1" cx="20" cy="20" r="20"/><path class="cls-2" d="M30.91,14.53a2.89,2.89,0,0,0-2-2C27.12,12,20,12,20,12s-7.12,0-8.9.47a2.9,2.9,0,0,0-2,2A30.56,30.56,0,0,0,8.63,20a30.44,30.44,0,0,0,.46,5.47,2.89,2.89,0,0,0,2,2C12.9,28,20,28,20,28s7.12,0,8.9-.47a2.87,2.87,0,0,0,2-2A30.56,30.56,0,0,0,31.37,20,28.88,28.88,0,0,0,30.91,14.53ZM17.73,23.41V16.59L23.65,20Z"/></svg></a>
        <a href="https://github.com/spring-projects" title="Github"><svg id="github-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 75.93 75.93"><path class="cls-1" d="M38,0a38,38,0,1,0,38,38A38,38,0,0,0,38,0Z"/></g><path class="cls-2" d="M38,15.59A22.95,22.95,0,0,0,30.71,60.3c1.15.21,1.57-.5,1.57-1.11s0-2,0-3.9c-6.38,1.39-7.73-3.07-7.73-3.07A6.09,6.09,0,0,0,22,48.86c-2.09-1.42.15-1.39.15-1.39a4.81,4.81,0,0,1,3.52,2.36c2,3.5,5.37,2.49,6.67,1.91a4.87,4.87,0,0,1,1.46-3.07c-5.09-.58-10.45-2.55-10.45-11.34a8.84,8.84,0,0,1,2.36-6.15,8.29,8.29,0,0,1,.23-6.07s1.92-.62,6.3,2.35a21.82,21.82,0,0,1,11.49,0c4.38-3,6.3-2.35,6.3-2.35a8.29,8.29,0,0,1,.23,6.07,8.84,8.84,0,0,1,2.36,6.15c0,8.81-5.37,10.75-10.48,11.32a5.46,5.46,0,0,1,1.56,4.25c0,3.07,0,5.54,0,6.29s.42,1.33,1.58,1.1A22.94,22.94,0,0,0,38,15.59Z"/></svg></a>
        <a href="https://twitter.com/springcentral" title="Twitter"><svg id="twitter-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 75.93 75.93"><circle class="cls-1" cx="37.97" cy="37.97" r="37.97"/><path id="Twitter-2" data-name="Twitter" class="cls-2" d="M55.2,22.73a15.43,15.43,0,0,1-4.88,1.91,7.56,7.56,0,0,0-5.61-2.49A7.78,7.78,0,0,0,37,30a7.56,7.56,0,0,0,.2,1.79,21.63,21.63,0,0,1-15.84-8.23,8,8,0,0,0,2.37,10.52,7.66,7.66,0,0,1-3.48-1v.09A7.84,7.84,0,0,0,26.45,41a7.54,7.54,0,0,1-2,.28A7.64,7.64,0,0,1,23,41.09a7.71,7.71,0,0,0,7.18,5.47,15.21,15.21,0,0,1-9.55,3.37,15.78,15.78,0,0,1-1.83-.11,21.41,21.41,0,0,0,11.78,3.54c14.13,0,21.86-12,21.86-22.42,0-.34,0-.68,0-1a15.67,15.67,0,0,0,3.83-4.08,14.9,14.9,0,0,1-4.41,1.24A7.8,7.8,0,0,0,55.2,22.73Z"/></svg></a>
    </div>
</footer>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
<script async src="../_/js/vendor/tabs.js"></script>
<script src="../_/js/vendor/docsearch.min.js"></script>
<script src="../_/js/vendor/switchtheme.js"></script>
<!-- fetched from https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js -->
<script>
docsearch({
  apiKey: '82c7ead946afbac3cf98c32446154691',
  appId: '244V8V9FGG',
  indexName: 'spring-docs',
  inputSelector: '#search-input',
  algoliaOptions: { hitsPerPage: 10 }
})
</script>
  </body>
</html>
